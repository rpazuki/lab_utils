pipelines:
    - AMN_build_dataset_pipeline:
        Inputs:
            #####################################
            # grothwth measurment csv
            - growth_data:
                - src: EMPTY
                - package:  labUtils.utils
                - method: read_csv
            # SBML model file
            - model_sbml:
                - src: EMPTY
                - package:  labUtils.amn_mappings
                - method: parse_sbml_exchanges
                - is_cached: true
             # SBML model file
            - model_sbml_bounds:
                - src: EMPTY
                - package:  labUtils.amn_mappings
                - method: parse_sbml_exchange_bounds
                - is_cached: true
        Processes:
            - mapping_df:
                package: labUtils.amn_mappings
                method: build_mappings
                parameters:
                    growth_rates_df: growth_data # The 'growth_data' input defined above
                    supplement_to_exchange_map: model_sbml # The 'model_sbml' input defined above
                    supplement_column: supplements # The column name for OD values in output dataframe
                    verbose: true
                    fixed_exchanges: #
                        - EX_pi_e
                        - EX_co2_e #
                        - EX_fe3_e
                        - EX_h_e #
                        - EX_pro__L_e
                        - EX_glyc_e
                        - EX_mn2_e
                        - EX_ala__L_e
                        - EX_fe2_e
                        - EX_gal_e # !!!!!
                        - EX_gly_e #
                        - EX_zn2_e
                        - EX_mg2_e
                        - EX_ca2_e
                        - EX_ni2_e
                        - EX_cu2_e
                        - EX_sel_e
                        - EX_cobalt2_e
                        - EX_h2o_e #
                        - EX_mobd_e
                        - EX_so4_e
                        - EX_thr__L_e
                        # - EX_nh4_e #
                        - EX_k_e #
                        # - EX_na1_e
                        # - EX_cl_e
                        - EX_o2_e #
                        - EX_tungs_e
                        - EX_slnt_e
            - df_flux:
                package: labUtils.amn_mappings
                method: build_supplement_flux_dataframe
                parameters:
                    growth_rates_df: growth_data # The 'growth_data' input defined above
                    mappings_df : mapping_df
            - df_AMN_input:
                package: labUtils.amn_mappings
                method: build_AMN_inputs_dataframe
                parameters:
                    growth_rates_df: growth_data # The 'growth_data' input defined above
                    mappings_df : mapping_df
                    supplement_column: supplements
                    growth_rate_column: mu_max
                    success_column: success
                    exchange_suffix: _i

            - df_AMN_level:
                package: labUtils.amn_mappings
                method: build_AMN_levels_dataframe
                parameters:
                    exchange_matrix: df_AMN_input # The 'df_AMN_input' input defined above
                    mappings_df : mapping_df
                    growth_rate_column: mu_max # The column name for growth rates in output dataframe
                    default_level: 1 # Default level
                    flux_df: df_flux
                    exchange_suffix: _i
                    # custom_bounds: # level, max_value
                    #     EX_glc__D_e_i: [100, 10]
                    #     EX_ade_e_i: [100, 10]
                    #     EX_succ_e_i: [100, 10]
                    #     EX_ura_e_i: [100, 10]
        Outputs:
            #####################################
            # List of output dataframes to save
            # to csv files
            - mapping_df: mappings.csv
            - df_flux: df_flux.csv
            - df_AMN_input: df_AMN_input.csv
            - df_AMN_level: df_AMN_level.csv

